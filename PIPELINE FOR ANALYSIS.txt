{\rtf1\ansi\ansicpg1252\cocoartf2639
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica-Bold;\f1\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red0\green0\blue0;\red199\green200\blue201;
\red26\green28\blue31;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c0\c1\c1;\cssrgb\c81961\c82353\c82745;
\cssrgb\c13333\c14510\c16078;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid3}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}}
\margl1440\margr1440\vieww11800\viewh12820\viewkind0
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\b\fs48 \cf0 Pipeline for Running S-Probe Analysis
\f1\b0\fs24 \
Neel Agarwal (07/2023)\cf2 \
\
Sessions: \
\pard\tx220\tx720\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\li720\fi-720\pardirnatural\partightenfactor0
\ls1\ilvl0\cf2 {\listtext	\uc0\u8226 	}c20230531007: this was the session where only half the probe worked\
{\listtext	\uc0\u8226 	}c20230602007: full session but weaker tuning and visually driven cells than the next 2\
{\listtext	\uc0\u8226 	}
\f0\b c20230607004
\f1\b0 : this was the really good session run on a black stimulus - use this one for your walkthrough analysis\
{\listtext	\uc0\u8226 	}c20230607005
\f0\b : 
\f1\b0 run directly after the previous session but in white. Still a very good session but it\'92s questionable whether we can actually call this a separate session from the previous\
{\listtext	\uc0\u8226 	}\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0
\cf2 Random Notes:\cf3 \
\pard\tx220\tx720\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\li720\fi-720\pardirnatural\partightenfactor0
\ls2\ilvl0\cf0 {\listtext	\uc0\u8226 	}When looking at units: unit 1 is the unsorted spikes, unit \
{\listtext	\uc0\u8226 	}to force quit when Matlab is running hit command + .\
{\listtext	\uc0\u8226 	}when recording an S-Probe data set: lower the probe with the thresholds set to -10mV then once you get a good signal on each contact switch to a threshold of -15mV (so that when we run analysis on unsorted spikes, we can eliminate more of the noise)\
{\listtext	\uc0\u8226 	}when sorting on Plexon Offline Sorter, sort all identifiable single units first. Then reorganizing which of the units you are going to place in the first position (on Plexon - the yellow spike) by weighing the number of the spikes you have, the ISI, the best waveform shape, the most stable waveform across the session (to negate drift).\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0
\cf0 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\b\fs28 \cf0 WHILE LOWERING THE PROBE (DURING RECORDING)\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f1\b0\fs24 \cf0 Notes:\
\pard\tx220\tx720\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\li720\fi-720\pardirnatural\partightenfactor0
\ls3\ilvl0\cf0 {\listtext	\uc0\u8226 	}Could be useful to first put the dual drive on the chamber because we are more familiar with how those drive coordinates map onto the RF map. If you do this make a slight mark by pressing the guide tube down onto the dura then quickly switch the single drive and line it up to match that guide tube mark.\
{\listtext	\uc0\u8226 	}Generally when lowering the probe we go in increments of 500microns while someone (Yasmine) is watching the chamber looking for CSF/buckling of the probe. \
{\listtext	\uc0\u8226 	}When watching the spike panel as the probe is lowering, we would expect spikes to appear first on channel 32 then following this order - 
\f0\b\fs28 [32, 30, 28, 26, 24, 22, 20, 18, 16, 14, 12, 10, 8, 6, 4, 2, 31, 29, 27, 25, 23, 21, 19, 17, 15, 13, 11, 9, 7, 5, 3, 1]
\f1\b0\fs24 \
\pard\tx220\tx720\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\li720\fi-720\pardirnatural\partightenfactor0
\ls3\ilvl0
\fs28 \cf0 {\listtext	\uc0\u8226 	}
\fs24 When running finder to get the general idea of the RF of that particular column. You should sample channels 28 (bottom), 2 (middle), 5 (top) on the spike panel.\
\ls3\ilvl0
\fs28 {\listtext	\uc0\u8226 	}
\fs24 When running the mapper experiment, it could be useful to put tape on the monitor that displays the stimulus in places you hear the hash get driven by presentation\
{\listtext	\uc0\u8226 	}
\f0\b YOU NEED TO WAIT 30 MINUTES FROM THE TIME THE PROBE IS IN ITS FINAL DEPTH AND THE TIME YOU BEGIN YOUR SHAPES AND BAR EXPERIMENT
\f1\b0 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\fs28 \cf0 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\fs24 \cf0 circleflashAnalysis/
\f0\b parserCircleFlash32.m : 
\f1\b0 use this protocol for a circle flash file that you record after lowering the probe and getting a good signal on every contact. This protocol can help you determine whether the unsorted units prefer a white to black stimulus (albeit weakly) and will calculate the LFP and CSD across the probe. This can controversially be used down the road to tell where layer 4 lives on the probe. ALSO USEFUL TO RERUN THIS PROTOCOL AT THE END OF THE SESSION SO THAT YOU CAN COMPARE HOW MUCH THE PROBE MOVED ACROSS THE LENGTH OF YOUR EXPERIMENT.\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\b\fs28 \cf0 POST HOC
\f1\b0\fs24 \
\
1. Sort the continuous data into spike timestamps on Plexon Offline Sorter. Filter using 500Hz Butterworth filter and detect waveforms using a -2.7 sigma threshold (I.e., 2.7 standard deviations above the noise).\
\
2. Save the file on Plexon Offline Sorter in the .nex format. Ensure to export only the spike timestamps that came from continuous data filtering/detecting. Make sure that you also export the unsorted spikes and make sure you check the box that actual sends the waveform shapes. Save the nex filename as [filename, _sorted.nex] ex. c20230607005_sorted.nex\
\
3. Use the 
\f0\b parser_ShapesBars32.m
\f1\b0  Matlab script to take the .nex, .nev and .ns4 of your session and turn it into a single .mat that includes the parsed oData and pData.\
\
(Note moving forward for subsequent analyses you will be loading in the .mat file)\
\
	YOU CAN DECIDE TO MODEL FIT NOW OR LATER - how to do it is explained under this indent\
	\
	
\f0\b\fs28 CURVATURE MODEL FIT
\f1\b0\fs24 \
	\
	a. Use 
\f0\b fitCModel.m
\f1\b0  script to fit the curvature model on your shape data. It requires that you first create 	a folder called [filename_modelFit] on engram in the data section of Blackrock  (ex. 	c20230607005_modelFit) where the output will live as well. Currently the fit is set to 10 iterations with no 	cross validation but can be changed depending on the stage of analysis you are at (refer to Yasmine to do 	this). This process of fitting takes a lot of time so you should run this overnight and on one of the rig 	MacBooks (computer with the most RAM in the 	lab). You can also choose to batch your analysis -> go to 	line 46 and change the indexing on unitIdentities(n:m).\
	\
	b.  After completely finishing the curvature model fit for all the cells in the session. Use 	
\f0\b mergeCModelFit.m
\f1\b0  	to concatenate all of your currently separate fits (for each neuron) into a single .at 	file which will be named 	filename_cModelFit.mat on engram (ex. c20230607005_cModelFit.mat). Now 	all the curvature model fit 	parameters and information will be accesible by loading this .mat file.\
\
	c. Use 
\f0\b checkCModelFit.m
\f1\b0  to review each of your curvature model fits. The script will plot a single units real 	data and the model fit over it (as well as some curves about the cells curvatures response preference). Use it 	to double check whether the model fits the data well and make notes of certain patterns/etc.. The channel 	and the unit of the cell (i.e., the identity of the unit) will be placed as the figure title in the format channel_unit.\
\
	
\f0\b\fs28 VM MODEL FIT
\f1\b0\fs24 \
\
	d. Use 
\f0\b fitVmModel.m 
\f1\b0 script to fit the von Mises function on your bar data. This fitting is not so 	computationally intensive so can be run on just about any computer. This script combines both 	processes for the curvature model fit so the output will be a .mat file called [filename_vmModelFit.mat] 	(ex. 	c20230607005_vmModelFit.mat). Now all the vm model fit parameters and information will be 	accesible by loading this .mat file.\
\
	e. Use 
\f0\b checkVmModelFit.m
\f1\b0  to review each of your von Mises model fits. The script will plot a single units 	real data and the model fit over it . Use it to double check whether the model fits the data well and make 	notes of certain patterns/etc.. The channel and the unit of the cell (i.e., the identity of the unit) will be 	placed as the figure title in the format channel_unit.\
\
\
4. Use the
\f0\b  tuningCluster.m
\f1\b0  Matlab script to create 8 plots that plots the tuning of all the units from all 32 channels. Messy plot because several units may be plotted on top of each other (depending if there are multiple isolated neurons on a contact). FIRST PASS ->  keep the plots opened or saved so that you can use them as a guide for the next step.\
\
5. Using the 
\f0\b plotSingleUnitTuningPsthWaveform.m
\f1\b0  script, a single unit on a single channel - to visualize tuning, rasters/psths, latency and waveform. You can pick out the best unit on each contact with this method (we did that in early analysis but have decided that it\'92s more meaningful to look at all units for population analyses -> clusters)\
\
\

\f0\b\fs28 Specific Analyses Scripts\
\
Notes for Yasmine\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f1\b0 \cf0 - I\'92ve noticed that for some looping of all my neurons, I use the unitIdentites and sometimes I loop first through 32 channels then through the units. I do the second when I want to retain the channel and unit structure for whatever analysis I\'92m doing. For example, if I want a 2D plot that has channel on the Y axis, latency on the x, and multiple point per y value that represent units.
\f0\b \
\

\f1\b0 barAnalysis
\fs24 \
\
- 
\f0\b plotOrientationTuningPolarAcrossProbe.m 
\f1\b0 : plots simple tuning curves for bar orientation but in polar coordinates. Each subplot represents a single channel (titled) and there are multiple units on each subplot each represented with a different color.\
\
- 
\f0\b plotBarSelectivityAcrossProbe.m 
\f1\b0 : using the vmModelFit, plots the orientation selectivity across the length of the probe while taking bandwidth in account. You need to have selected the set of cells where the model fit actually fits the real data prior (use 
\f0\b checkVmModelFit.m
\f1\b0 ).\
\
- 
\f0\b plotOrientationSelectivityPolarAcrossProbe.m 
\f1\b0 : using vmModelFit, plots the orientation selectivity across the probe in polar coordinates (doesn\'92t look at bandwidth). This is a population level plot. The data is doubled to span 0-360 degrees by duplicating each orientation selectivity value (0-157.5) and adding 180. The center of the plot is the top of the probe and the edge is the bottom of the probe.\
\
- 
\f0\b plotPairWiseCorrBarTuningMatrix.m 
\f1\b0 : (PROBLEMATIC ANALYSIS) plots a heat map of the correlation in bar tuning across all pairwise combinations of units in the session. This analysis isn\'92t the best because orientation is circular and not linear. i.e., the correlation doesn\'92t take into account if the last values of the firing rate list for unit 1 is similar to the first value of the firing rate list for unit 2.\
\

\fs28 curvatureAnalysis\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\fs24 \cf0 **** Function ****\
\
 - 
\f0\b plotModelFitTuning.m :
\f1\b0  function that is called on in some of the scripts writing within the shapes and bars analysis pipeline. It\'92s what to use when you want to plot the real shape data with the curvature model fit over it. It also plots features of the stimulus the cell best responds to (angular position, primary curvature, cw curvature, cow curvature). You can refer to 
\f0\b checkCModelFit.m 
\f1\b0 to see how it\'92s used.\
\
**** Scripts ****
\fs28 \
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\b\fs24 \cf0 - plotPrimaryCurvatureXAngularPositionAcrossProbe.m : VERY INSIGHTFUL ANALYSIS (YASMINE THIS IS THE 3D ELLIPSE PLOT) - 
\f1\b0 plots the preferred primary curvature and angular position with their respective sigmas as transparent ellipses. The 3D version is easier to understand. Currently is written to plot the E neurons in blue, the I neurons in red, the unclassified (qualitatively done to be trimodal or peak before trough neurone) -> this can easily be changed to make them all transparent grey if you want. I like looking at the view were you only see the x and y axis so all the transparent ellipses are stacked on top of each other (to look for clustering or laminar consistencies).\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\fs28 \cf0 \
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\fs24 \cf0 - 
\f0\b plotShapeAngularPositionXBarOrientation.m : 
\f1\b0 plots the orientation selectivity based on the vmModelFit on the x axis and preferred angular position for shapes on the y for a particular neuron. NOTE: ANGULAR POSITION 0 MAY NOT BE EQUIVALENT TO BAR ORIENTATION 0 - MAKES THIS ANALYSIS UNFINISHED/WEAK
\f0\b \
\
\
- plot2DcorrX4Dcorr.m :  
\f1\b0 plots the 2D corr value on x and 4D correlation value on y for a particular neuron (these values represent how well our 2D and 4D model fit the data). Used to determine which model fit the data better and generally what type of correlation values we are getting from the model for this particular session. There is a vertical line that represents the median 2D model fit correlation value and horizontal line for 4D median.\
\
- 
\f0\b plotPrimaryXCwXCcwCurvaturesAcrossProbe.m : 
\f1\b0 Used to plot the preferred primary, clockwise and counterclockwise features of the neuron in 3D based on the curvature model fit. The points are different colours which spans the Matlab hot colormap to represent which specific units channel. This analysis script hasn\'92t been used much by me yet but it seems like it could be a useful tool in the future.\
\
- 
\f0\b plotShapeAngularPositionAndBarOrientationAcrossProbe.m 
\f1\b0 : plots the orientation selectivity for bars with bandwidth as error bars across the probe on the first subplot (based on vm model fit).The second subplot is the angular position preference for shapes with its sigma as error bars across the probe (based on curvature model fit). NOTE: ANGULAR POSITION 0 MAY NOT BE EQUIVALENT TO BAR ORIENTATION 0 - MAKES THIS ANALYSIS UNFINISHED/WEAK\
\
- 
\f0\b plotPolarRepresentationCurvatureModel.m : 
\f1\b0 uses polar plots to visualize the 4 main parameters that come out of the 4D curvature model fit (angular position, primary, clockwise, counterclockwise curvature). This is an abstract representation created to try and visualize the 4 dimensions of the model fit in a meaningful way. There are 32 polar plots representing the channels and each subplot has all the units that were isolated on that channel. To interpret - look for the center of the 3 points - on the radius axis that\'92s primary curvature and on the degree axis that\'92s angular position. Then the points that surround it represent the cw and ccw curvatures (placed 45 degrees to cw or cow to the angular position). There is a circle plotted at the center of the plot at radius = 0 which represents the boundary between convex curvature features and concave curvature features. (-1 concave, +1 convex).\
\
- 
\f0\b plotSingleUnitCModelFitTuning.m : 
\f1\b0 plots the real shape tuning data and the predicted curvature model fit data of a particular single unit on a specific channel. Essentially calls the function 
\f0\b plotModelFitTuning.m 
\f1\b0 explained above but here you only have to input the channel and unit identity of your neuron of interest.\
\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\fs28 \cf0 waveformAnalysis\
\
NOTE: to do waveform analyses you need to have looked through all waveforms and eliminated waveforms that are not bimodal and don\'92t have a through before a peak. Once you have qualitatively done this, write the unit identities into the 
\f0\b getEICheck.m 
\f1\b0 function in the functionsNA folder - follow the nomenclature for the other filenames that this was done for.\
\
NOTE: we call a waveform I if spike width is less than or equal to 0.2ms and E if greater\
\
NOTE: noticeably more inhibitory neurons than excitatory neurons
\fs24 \
\
\
 
\f0\b saveEvIcModelFit.m : 
\f1\b0 saves the curvature model fit plots but separates units depending on whether they are E v I based on spike width and qualitative removal of spike waveforms that aren\'92t bimodal and through-peak organization. Useful for determining the differences in putative E and I tuning, model parameters, feature preferences, whether one has more broad tuning, etc.\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\b \cf0 plotSpikeWaveformsAcrossProbe.m : 
\f1\b0 plots the waveforms that were determined usable for waveform analysis across the probe. Organization 4 x 8 subplots with the channel number represented as the title. The waveforms are also color coated based on whether they are E or I.\
\

\f0\b plotSpikeWaveformsPopulation.m : 
\f1\b0 plots all the waveforms of every unit in the session on top of each other. Inhibitory neurons are red, excitatory are blue and other are grey. The total number that belongs to each category is put as the title of the figure.\
\

\f0\b plotSpikeWidthDistribution.m : 
\f1\b0 calculates the spike width of all the isolated units within the session then uses a 0.01 ms bin width to plot the spike width distribution (histogram). Used to see the population level spike widths - we would expect the distribution to be bimodal that separates at 0.2ms which is the widely accepted boundary between E v I neurons. \
\
\
\
\
\pard\pardeftab720\partightenfactor0

\fs30 \cf4 \cb5 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec4 plotSpikeWaveformsAcrossProbe.m and plotSpikeWaveformsPopulation.m in the waveformAnalysis folder also include the ones that don\'92t meet the EvI criteria. The others are in grey (that don\'92t fall into bimodal and through then peak)
\fs24 \cf0 \cb1 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0
\cf0 \
\
\pard\pardeftab720\partightenfactor0

\fs30 \cf4 \cb5 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec4 Also - there\'92s a script called checkEachSingleUnit.m in the general sProbeNA folder that cycles through each individual single unit and plots tuning, psth and waveform so you can check all the data.
\f0\b\fs24 \cf0 \cb1 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f1\b0 \cf0 \
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\b \cf0 \
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f1\b0 \cf0 \
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
}